name: Simple CI - Build & Push to Docker Hub

# –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow
on:
  push:
    branches: [main, master]  # –ü—Ä–∏ –ø—É—à–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É
  workflow_dispatch:          # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
env:
  DOCKER_IMAGE_NAME: devasher/test-app  # ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Å–≤–æ–π username

jobs:
  # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –¥–∂–æ–±–∞ - —Å–±–æ—Ä–∫–∞ –∏ –ø—É—à
  build-and-push:
    name: Build Docker Image and Push to Hub
    runs-on: ubuntu-latest
    
    steps:
    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: üì• Checkout Repository
      uses: actions/checkout@v4
      
    # –®–∞–≥ 2: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–º–∏—Ç–µ  
    - name: üìã Show Build Info
      run: |
        echo "üöÄ Building Docker image for commit: ${{ github.sha }}"
        echo "üì¶ Image will be tagged as: ${{ env.DOCKER_IMAGE_NAME }}:latest"
        echo "üì¶ Image will be tagged as: ${{ env.DOCKER_IMAGE_NAME }}:${{ github.sha }}"
        
    # –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Docker Buildx (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π)
    - name: üîß Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      
    # –®–∞–≥ 4: –í—Ö–æ–¥–∏–º –≤ Docker Hub
    - name: üîê Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        
    # –®–∞–≥ 5: –°–æ–±–∏—Ä–∞–µ–º –∏ –ø—É—à–∏–º Docker –æ–±—Ä–∞–∑
    - name: üèóÔ∏è Build and Push Docker Image
      uses: docker/build-push-action@v5
      with:
        context: .                    # –ö–æ–Ω—Ç–µ–∫—Å—Ç - —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
        file: ./Dockerfile           # –ü—É—Ç—å –∫ Dockerfile
        push: true                   # –ü—É—à–∏—Ç—å –≤ registry
        tags: |
          ${{ env.DOCKER_IMAGE_NAME }}:latest
          ${{ env.DOCKER_IMAGE_NAME }}:${{ github.sha }}
        platforms: linux/amd64      # –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (—É–ø—Ä–æ—â–∞–µ–º –¥–æ –æ–¥–Ω–æ–π)
        
    # –®–∞–≥ 6: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    - name: ‚úÖ Build Complete
      run: |
        echo "üéâ Build completed successfully!"
        echo ""
        echo "üì¶ Published images:"
        echo "   ‚Ä¢ ${{ env.DOCKER_IMAGE_NAME }}:latest"
        echo "   ‚Ä¢ ${{ env.DOCKER_IMAGE_NAME }}:${{ github.sha }}"
        echo ""
        echo "üîß To deploy manually, use:"
        echo "   docker pull ${{ env.DOCKER_IMAGE_NAME }}:latest"
        echo "   docker run -p 5000:5000 ${{ env.DOCKER_IMAGE_NAME }}:latest"
        echo ""
        echo "üîÑ Next steps:"
        echo "   1. Test the image locally"
        echo "   2. Set up Kubernetes cluster" 
        echo "   3. Create deployment manifests"
